{%- assign secSt = section.settings -%}
<section section-name="priducts-tab-slider" style="background-color:{{secSt.bg_color}}"
  class="{% render 'section-interva-set' , secSt:secSt %}">
  <div class="page-width">
    <div class="tw-mb-18">
      <h1 class="tw-text-6xl tw-mb-4">{{secSt.title}}</h1>
      <p class="tw-text-lg">{{secSt.content | newline_to_br}}</p>
    </div>
    <div class="tw-flex tw-w-full tw-border-solid tw-border-0 tw-border-b tw-border-black tw-mb-14">
      {%- for block in section.blocks -%}
        {%- assign blkSt = block.settings -%}
        <div class="item-tab tw-cursor-pointer tw-mr-16 tw-border-solid tw-border-0 tw-border-black tw-text-stone-500 tw-transition-all {% if forloop.first %}[&>p]:tw-text-black tw-border-b-4 tw-font-semibold{% endif %}">
          <p class="tw-text-2xl">{{ blkSt.title }}</p>
        </div>
      {% endfor %}
    </div>

    <div>
      {%- for block in section.blocks -%}
      <div class="item-slider">
        <div class="flickity-div">
          {%- assign blkSt = block.settings -%}
          {% for product in blkSt.collection.products %}
            <div class="tw-w-[48.5%] tw-mr-[3%]">
              <div class="tw-bg-[#f7f7f7] tw-rounded-xl tw-px-8 tw-py-6 ">
                <div class="tw-w-5/6 tw-mx-auto tw-mb-8"> {% include 'aspect-ratio-img', media: product.featured_media.preview_image ,class: 'tw-block'%} </div>
                <div class="tw-flex tw-justify-between tw-items-center">
                  <div class="tw-flex tw-items-center">
                    <p class="tw-font-semibold tw-text-xl tw-mb-0">
                      {% if product.metafields.custom.model != blank %}
                        {{ product.metafields.custom.model }}
                        {% else %}
                        {{ product.title }}
                      {% endif %}
                    </p>
                    <span class="tw-mx-3 tw-mb-0">|</span>
                    <p class="tw-mb-0">
                      {%- if product.price_varies -%}
                        {%- assign price = product.price_min | money -%}
                        {{ 'products.general.from_text_html' | t: price: price }}
                      {%- else -%}
                        {{ product.price | money }}
                      {%- endif -%}
                    </p>
                  </div>
                  <div>

                    {%- liquid
                      assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase
                      assign swatch_file_extension = 'png'
                      assign color_count = 0
                    -%}

                    {%- for option in product.options_with_values -%}
                      {%- liquid
                        assign option_name = option.name | downcase
                        assign is_color = false
                        if option_name contains swatch_trigger
                          assign is_color = true
                        elsif swatch_trigger == 'color' and option_name contains 'colour'
                          assign is_color = true
                        endif
                      -%}
                      {%- if is_color -%}
                        {%- assign option_index = forloop.index0 -%}
                        {%- assign values = '' -%}
                        <div class="grid-product__colors grid-product__colors--{{ product.id }}">
                          {%- for variant in product.variants -%}
                            {%- assign value = variant.options[option_index] %}
                            {%- unless values contains value -%}
                              {%- liquid
                                assign values = values | join: ',' | append: ',' | append: value | split: ','
                                assign color_file_name = value | handle | append: '.' | append: swatch_file_extension
                                assign color_image = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
                                assign color_swatch_fallback = value | split: ' ' | last | handle
                                assign color_count = color_count | plus: 1
                              -%}
                              {% for variant in product.variants %}
                                {%- if variant.title contains value -%}
                                  {%- assign variantImgSrc = variant.image.src | img_url: '120x', scale: 1, crop: 'center' -%}
                                  {%- break -%}
                                {%- endif -%}
                              {% endfor %}
                              <a
                                class="color-swatch color-swatch--small color-swatch--{{ value | handle }}{% if variant.image %} color-swatch--with-image{% endif %}"
                                {% if variant.image %}
                                  data-variant-id="{{ variant.id }}"
                                  data-variant-image="{{ variant.image | img_url: 'master' }}"
                                {% endif %}
                                aria-label="{{ product.title }} - {{ value }}"
                                style="background-image: url({{ variantImgSrc }});">
                                <span class="visually-hidden">{{ value }}</span>
                              </a>
                            {%- endunless -%}
                          {%- endfor -%}
                        </div>
                        {%- if color_count < 2 -%}
                          {%- style -%}
                            .grid-product__colors--{{ product.id }} {
                              display: none;
                            }
                          {%- endstyle -%}
                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}







                  </div>
                  <a href="{{product.url}}" class="hover:tw-font-semibold hover:tw-text-vi">{{ 'general.accessibility.learn_more' | t }}</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="tw-flex tw-items-center tw-justify-end tw-mt-8">
          <span class="slider-prev tw-cursor-pointer">
            <svg t="1689736660004" class="icon tw-w-12 tw-h-12" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2512" width="32" height="32"><path d="M213.333333 507.733333h725.333334v42.666667H204.8l145.066667 145.066667-29.866667 29.866666L128 533.333333 320 341.333333l29.866667 29.866667L213.333333 507.733333z" fill="#444444" p-id="2513"></path></svg>
          </span>
          <span class="tw-text-2xl tw-mx-4">Explore</span>
          <span class="slider-next tw-cursor-pointer">
            <svg t="1689736648452" class="icon tw-w-12 tw-h-12" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2273" width="32" height="32"><path d="M853.333333 507.733333H128v42.666667h733.866667l-145.066667 145.066667 29.866667 29.866666 192-192L746.666667 341.333333l-29.866667 29.866667 136.533333 136.533333z" fill="#444444" p-id="2274"></path></svg>
          </span>
        </div>
      </div>
      {%- endfor -%}
    </div>

  </div>
</section>

<script>


  var $carousel = $('#shopify-section-{{section.id}} .flickity-div');
  setTimeout(()=>{
    $('#shopify-section-{{ section.id }} .flickity-div').each(function(index) {

      let flkty = new Flickity( this, {
          pageDots: false,
          prevNextButtons: false,
          imagesLoaded: true,
          wrapAround: false,
          draggable: true,
          contain: true,
          groupCells: 2,
          on: {
            ready: function() {
              console.log(index);
              console.log($carousel);

              if (index === $carousel.length - 1) {
                
                $("#shopify-section-{{section.id}} .item-slider:not(:first-child)").addClass("tw-hidden")
              }
            }
          }
      });

      var $next = $(this).parent(".item-slider").find('.slider-next');
      var $prev = $(this).parent(".item-slider").find('.slider-prev');
      $next.on('click', function() { flkty.next(); });
      $prev.on('click', function() { flkty.previous(); });

    });
  }, 300);





  $('#shopify-section-{{section.id}} [section-name="priducts-tab-slider"] .item-tab').click(function() {
    const i = $(this).index();
    $($('.item-slider')[i]).removeClass('tw-hidden');
    $($('.item-slider')[i]).siblings().addClass('tw-hidden');
    $(this).siblings().removeClass('tw-font-semibold tw-border-b-4 [&>p]:tw-text-black');
    $(this).addClass('tw-font-semibold tw-border-b-4 [&>p]:tw-text-black');
  });

</script>


{% schema %}
  {
    "name": "Priducts tab slider v1.1",
    "tag": "section",
    "settings": [
      {
        "type": "header",
        "content": "Section interval set"
      },
      {
        "type": "select",
        "id": "top_padding",
        "label": "top interval",
        "default": "large",
        "options": [
          {
            "value": "large",
            "label": "Large"
          },
          {
            "value": "default",
            "label": "Default"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "none",
            "label": "None"
          }
        ]
      },
      {
        "type": "select",
        "id": "bottom_padding",
        "label": "bottom interval",
        "default": "default",
        "options": [
          {
            "value": "large",
            "label": "Large"
          },
          {
            "value": "default",
            "label": "Default"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "none",
            "label": "None"
          }
        ]
      },
      {
       "type": "color",
       "id": "bg_color",
       "label": "Background color",
       "default":"#E8EBF0"
     },
     {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop E-bikes"
     },
     {
      "type": "textarea",
      "id": "content",
      "label": "Content",
      "default": "We provide the best quality products at the best possible price because we are a direct-to-customer business. So, no matter what your age or what your job is, no matter who you are or where you come from, we strive to offer cost-efficient electric bikes for you."
     }
    ],
    "blocks": [
      {
        "type": "collection",
        "name": "Collection",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "EB7 2.0"
          },
          {
            "type": "collection",
            "id": "collection",
            "label": "Select collection"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Priducts tab slider v1.1"
      }
    ]
  }
{% endschema %} 